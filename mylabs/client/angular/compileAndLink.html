<!DOCTYPE html>
<html ng-app="plunker">

<head>
    <title>angular compile&link</title>
    <meta charset="utf-8">
    <style type="text/css">
      .animate-if {
	    background:white;
	    border:1px solid black;
	    padding:10px;
	  }

	  .animate-if.ng-enter, .animate-if.ng-leave {
	    -webkit-transition:all cubic-bezier(0.250, 0.460, 0.450, 0.940) 0.5s;
	    transition:all cubic-bezier(0.250, 0.460, 0.450, 0.940) 0.5s;
	  }

	  .animate-if.ng-enter,
	  .animate-if.ng-leave.ng-leave-active {
	    opacity:0;
	  }

	  .animate-if.ng-leave,
	  .animate-if.ng-enter.ng-enter-active {
	    opacity:1;
  }
    </style>
</head>

<body>
    <level-one ng-controller="MainCtrl">
        <level-two>
            <level-three>
                Hello
            </level-three>
        </level-two>
    </level-one>
    Click me:
    <input type="checkbox" ng-model="checked" ng-init="checked=true" />
    <input type="checkbox" ng-model="checked1" ng-init="checked1=true" />
    <input type="checkbox" ng-model="checked2" ng-init="checked2=true" />
    <input type="checkbox" ng-model="checked3" ng-init="checked3=true" />

    <br/> Show when checked:
    <span ng-if="checked" class="animate-if">
    	
    I'm removed when the checkbox is unchecked.
  	</span>
    <script type="text/javascript" src="./../libs/js/angular.js"></script>
    <script type="text/javascript" src="./../libs/js/angular-animate.js"></script>
    <script type="text/javascript">
    // +function(){
    var app = angular.module('plunker', []);

    function createDirective(name) {
        return function() {
            return {
                restrict: 'E',
                compile: function(tElem, tAttrs) {
                    console.log(name + ': compile => ' + tElem.html());
                    tElem[0].setAttribute('a', 'b');

                    var c = document.createAttribute('class');
                    c.nodeValue = "democlass";
                    tElem[0].setAttributeNode(c);

                    tElem.addClass('cc');
                    return {
                        pre: function(scope, iElem, iAttrs) {
                            console.log(name + ': pre link => ' + iElem.html());
                        },
                        post: function(scope, iElem, iAttrs) {
                            console.log(name + ': post link => ' + iElem.html());
                        }
                    }
                }
            }
        }
    }

    app.directive('levelOne', createDirective('levelOne'));
    app.directive('levelTwo', createDirective('levelTwo'));
    app.directive('levelThree', createDirective('levelThree'));

    app.controller('MainCtrl', function($scope) {
        $scope.user = {
            name: "Fox"
        };

        $scope.updated = 0;

        $scope.$watch('user', function(newValue, oldValue) {
            if (newValue === oldValue) {
                return;
            }
            $scope.updated++;
        }, true);
    });

    // }();
    </script>
</body>

</html>
